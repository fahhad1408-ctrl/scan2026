<!DOCTYPE html>
<html>
<head>
    <title>ุฃุฏุงุฉ ุงููุญุต ุงูุฃููู ุงููุชูุฏูุฉ</title>
    <style>
        /* ุงูุชูุณูู ุงูุนุงู ูุงูุงุญุชุฑุงูู (ุจุฏูู ุชุบููุฑ ุนู ุงูููุฏ ุงูุณุงุจู) */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        .container {
            max-width: 650px;
            margin: 20px auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        h2 {
            color: #004d99;
            margin-bottom: 25px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }

        /* ุฑุณุงูุฉ ุงูุชูุฌูู */
        .instruction {
            background-color: #fff9e6;
            border: 1px solid #ffeb77;
            color: #8a6d3b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: right;
            line-height: 1.6;
        }
        .instruction strong {
            color: #cc0000;
        }

        /* ุฒุฑ ุงููุญุต */
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 30px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* ุตูุฏูู ูุชุงุฆุฌ ุงูุญุงูุฉ */
        #status {
            font-size: 1.8em; 
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        /* ูุฆุงุช ุงูุฃููุงู ูููุชุงุฆุฌ */
        .safe { background-color: #d4edda; color: #155724; border: 2px solid #218838; }
        .suspicious { background-color: #fff3cd; color: #856404; border: 2px solid #ffc107; }
        .critical { background-color: #f8d7da; color: #721c24; border: 2px solid #dc3545; }
        .info { background-color: #cce5ff; color: #004085; border: 2px solid #007bff; }

        /* ุดุฑูุท ุงูุชูุฏู */
        .progress-bar-container {
            height: 30px;
            background-color: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 25px;
            border: 1px solid #ccc;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #1e7e34;
            transition: width 0.5s ease-out;
            text-align: center;
            color: white;
            line-height: 30px;
            font-weight: bold;
            font-size: 1.1em;
        }

        /* ููุทูุฉ ุชูุงุตูู ุงููุญุต */
        #details {
            text-align: right;
            border-top: 1px dashed #ccc;
            padding-top: 20px;
            line-height: 2.0;
            font-size: 1.0em;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        #details p { margin: 0; padding: 5px 0; }
        #details strong {
            color: #004d99;
            display: inline-block;
            min-width: 150px; 
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>ูุธุงู ุงููุญุต ุงูุฃููู ุงููุชูุฏู ูููููุน</h2>

        <div class="instruction">
            <p>ูุฅุฌุฑุงุก ูุฐุง ุงููุญุต ุงูุดุงูู ุงูุฐู ูุณุชุบุฑู ุญูุงูู **8 ุซูุงูู**ุ ูุฌุจ ุนููู **ุงูููุงููุฉ ุนูู ูุดุงุฑูุฉ ุงููููุน** ุนูุฏูุง ูุทูุจ ุงููุชุตูุญ ุงูุฅุฐู. </p>
            <p><strong>ุชูุจูู:</strong> ุณูุชู ุงููุญุต ูุฑุฉ ูุงุญุฏุฉ ููุทุ ููู ุงูุนุฏุงุฏ ุณูุณุชูุฑ ุญุชู 100% ูุฅููุงู ุฌููุน ุงูุชุญูููุงุช ุงูุฃูููุฉ.</p>
        </div>

        <button id="scanButton" onclick="startScan()">ุงูุจุฏุก ูู ุงููุญุต ุงูุฃููู ุงูุดุงูู</button>
        
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar">0% - ุงูุชุธุงุฑ ุงููุญุต</div>
        </div>
        
        <div id="status" class="info">ุงุถุบุท ุนูู ุฒุฑ ุงููุญุต ูุจุฏุก ุชุญููู ุงููุธุงู.</div>
        
        <div id="details">
            <p><strong>ุญุงูุฉ ูุธุงู ุงูุชุดุบูู:</strong> ูุฑุงุกุฉ ุฃูููุฉ...</p>
            <p><strong>ุทุฑุงุฒ ุงูุฌูุงุฒ (ูุณุชุฏู):</strong> ูุฑุงุกุฉ ุฃูููุฉ...</p>
            <p><strong>ุฅุตุฏุงุฑ ุงููุชุตูุญ:</strong> ูุฑุงุกุฉ ุฃูููุฉ...</p>
            <p><strong>ุญุงูุฉ ุงุชุตุงู ุงูุดุจูุฉ:</strong> ูุฑุงุกุฉ ุฃูููุฉ...</p>
            <p><strong>ูุตุฏุฑ ุงููููุน (ูุณุชุดุนุฑุงุช):</strong> --</p>
            <p><strong>ูุฏููุฉ ุงูู IP (ุงูููุนููุฉ):</strong> --</p>
            <p><strong>ุชูุงูุถ IP/GPS:</strong> --</p>
            <p><strong>ูุณุชูู ุงูุฏูุฉ ุงูููุณุชูุชุฌ:</strong> --</p>
        </div>
    </div>

    <script>
        let ipLocation = null;
        let finalResult = { message: 'โ ุงููููุน ุณููู ูููุซูู 100% (ุงูุฌูุงุฒ ุขูู).', className: 'safe', details: {} };
        
        // --- ุซูุงุจุช ุงููุดู (ุชู ุชุนุฏูู FAIL_ACCURACY_THRESHOLD) ---
        const PERFECT_ACCURACY_THRESHOLD = 5; 
        const FAIL_ACCURACY_THRESHOLD = 100000; // 100 ููุ ููุชุณุงูุญ ูุน ุถุนู ุฅุดุงุฑุฉ ุฃุจุฑุงุฌ ุงูุฌูุงู
        const VPN_DISCREPANCY_THRESHOLD_KM = 50; 
        const SCAN_DURATION_MS = 8000; 
        
        // --- ูุธุงุฆู ูุณุงุนุฏุฉ ---
        function deg2rad(deg) { return deg * (Math.PI / 180); }
        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; 
        }

        function inferLocationSource(accuracy) {
            if (accuracy <= 10) {
                return "GPS ุนุงูู ุงูุฏูุฉ (ุฃููุงุฑ ุตูุงุนูุฉ)";
            } else if (accuracy <= 100) {
                return "Wi-Fi ุฃู GPS ุงููุณุงุนุฏ";
            } else if (accuracy <= 5000) {
                return "ุดุจูุฉ ุงูุฌูุงู (Cell ID)";
            } else {
                return "ุดุจูุฉ ุงูุฌูุงู (ุฏูุฉ ููุฎูุถุฉ ุฌุฏุงู)";
            }
        }
        
        function getDeviceInfo() {
            const ua = navigator.userAgent;
            let os = "ุบูุฑ ูุนุฑูู";
            let model = "ุบูุฑ ูุญุฏุฏ";
            let browser = "ุบูุฑ ูุนุฑูู";

            if (/android/i.test(ua)) {
                os = "Android";
                const match = ua.match(/Android\s+([0-9\.]+)/i);
                if (match) os += ` (${match[1]})`;
            } else if (/iphone|ipad|ipod/i.test(ua)) {
                os = "iOS";
                const match = ua.match(/OS\s+(\d+_\d+)/i);
                if (match) os += ` (${match[1].replace(/_/g, '.')})`;
                model = /iphone/i.test(ua) ? "iPhone" : (/ipad/i.test(ua) ? "iPad" : "iPod");
            } else if (/windows/i.test(ua)) {
                os = "Windows";
            } else if (/macintosh|mac os x/i.test(ua)) {
                os = "macOS";
            }
            
            if (/chrome/i.test(ua) && !/edge/i.test(ua)) browser = "Chrome";
            else if (/safari/i.test(ua) && !/chrome/i.test(ua)) browser = "Safari";
            else if (/firefox/i.test(ua)) browser = "Firefox";
            else if (/edge/i.test(ua)) browser = "Edge";
            
            const versionMatch = navigator.appVersion.match(/(Version\/[\d\.]+)/);
            browser = browser + " " + (versionMatch ? versionMatch[1] : '');
            
            return { os, model, browser };
        }

        async function getIPLocation() {
            try {
                const response = await fetch('https://ipinfo.io/json'); 
                const data = await response.json();
                
                if (data.loc) { 
                    const [lat, lon] = data.loc.split(',').map(Number);
                    return { lat, lon, city: data.city || 'ุบูุฑ ูุนุฑูู', country: data.country || 'ุบูุฑ ูุนุฑูู' };
                } else {
                    return null;
                }
            } catch (error) {
                return null;
            }
        }

        // --- ูุธููุฉ ุชุญุฏูุซ ุดุฑูุท ุงูุชูุฏู ูุงูุฑุณุงูุฉ ---
        function updateProgress(percentage, statusMessage = null) {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            if (statusMessage) {
                progressBar.innerHTML = statusMessage;
            } else {
                progressBar.innerHTML = `${Math.round(percentage)}% - ุฌุงุฑู ุงูุชุญููู ุงูุฃููู...`;
            }
        }

        // --- ูุธููุฉ ุนุฑุถ ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ (ุชู ุฅุฎูุงุก ุงูุฅุญุฏุงุซูุงุช) ---
        function displayFinalResults(result, deviceInfo, ipInfo, gpsInfo) {
            const ipCity = ipInfo ? ipInfo.city : 'ูุดู ุงููุฑุงุกุฉ';
            const ipCountry = ipInfo ? ipInfo.country : 'ูุดู ุงููุฑุงุกุฉ';
            
            document.getElementById('status').innerHTML = result.message;
            document.getElementById('status').className = 'result ' + result.className;

            document.getElementById('details').innerHTML = `
                <p><strong>ุญุงูุฉ ูุธุงู ุงูุชุดุบูู:</strong> ${deviceInfo.os}</p>
                <p><strong>ุทุฑุงุฒ ุงูุฌูุงุฒ (ูุณุชุฏู):</strong> ${deviceInfo.model !== 'ุบูุฑ ูุญุฏุฏ' ? deviceInfo.model : 'ูุงุชู ุนุงู/Android'}</p>
                <p><strong>ุฅุตุฏุงุฑ ุงููุชุตูุญ:</strong> ${deviceInfo.browser}</p>
                <p><strong>ุญุงูุฉ ุงุชุตุงู ุงูุดุจูุฉ:</strong> ${navigator.onLine ? 'ูุชุตู (Online)' : 'ุบูุฑ ูุชุตู (Offline)'}</p>
                
                <p><strong>ูุตุฏุฑ ุงููููุน (ูุณุชุดุนุฑุงุช):</strong> ${gpsInfo.source}</p>
                <p><strong>ูุณุชูู ุงูุฏูุฉ ุงูููุณุชูุชุฌ:</strong> ${gpsInfo.inferred_accuracy}</p>
                <p><strong>ูุฏููุฉ ุงูู IP (ุงูููุนููุฉ):</strong> ${ipCity} (${ipCountry})</p>
                <p><strong>ุชูุงูุถ IP/GPS:</strong> ${gpsInfo.discrepancy > 0 ? gpsInfo.discrepancy.toFixed(0) + ' ูู (ูุดุชุจู ุจู VPN)' : 'ูุง ููุฌุฏ ุชูุงูุถ ูุจูุฑ'}</p>
            `;
            document.getElementById('scanButton').disabled = false;
        }

        // --- ูุธููุฉ ุงูุชุญููู ุงูุฃููู ูููููุน (ูุน ุงูููุทู ุงูุฌุฏูุฏ) ---
        function analyzeLocation(position, ipInfo) {
            const acc = position.coords.accuracy;
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            let discrepancy = 0;
            let message = 'โ ุงููููุน ุณููู ูููุซูู 100% (ุงูุฌูุงุฒ ุขูู).';
            let className = 'safe';

            const source = inferLocationSource(acc);
            let inferredAccuracyText = 'ุฏูุฉ ุนุงููุฉ ุฌุฏุงู (ุฃูุถู ูู 100 ูุชุฑ)';

            if (acc > 1000) {
                 inferredAccuracyText = 'ุฏูุฉ ููุฎูุถุฉ (ุฃูุซุฑ ูู 1 ูู)';
            }
            if (acc > 10000) {
                 inferredAccuracyText = 'ุฏูุฉ ููุฎูุถุฉ ุฌุฏุงู (ุฃูุซุฑ ูู 10 ูู)';
            }

            // 1. ูุญุต ุชูุงูุถ IP/GPS (ูุดู VPN ูู ุงูุฃููููุฉ ุงููุตูู)
            if (ipInfo && acc < FAIL_ACCURACY_THRESHOLD) { 
                discrepancy = getDistance(lat, lon, ipInfo.lat, ipInfo.lon);

                if (discrepancy > VPN_DISCREPANCY_THRESHOLD_KM) {
                    message = `๐จ **ุชู ุงููุดู ุนู ุชุฒููู ุงููููุน (VPN/Proxy):** ุงููููุน ุงููุณุชูุฏ ุฅูู ุงูุดุจูุฉ ูุฎุชูู ุจู ${discrepancy.toFixed(0)} ูู. ุญุงูุฉ ุญุฑุฌุฉ!`;
                    className = 'critical';
                }
            }

            // 2. ูุญุต ุงูุฏูุฉ (ูุญุต ุชุฒููู GPS - ุซุงูู ุฃููููุฉ)
            if (acc < PERFECT_ACCURACY_THRESHOLD && className !== 'critical') {
                message = `๐จ **ุชู ุงููุดู ุนู ุชุฒููู ุงููููุน (GPS):** ุฏูุฉ ุงููููุน ูุซุงููุฉ ุจุดูู ูุฑูุจ (${acc.toFixed(2)} ูุชุฑ). ุญุงูุฉ ุญุฑุฌุฉ!`;
                className = 'critical';
            } else if (acc > FAIL_ACCURACY_THRESHOLD && className !== 'critical') {
                // ุงูุงุดุชุจุงู ุจุณุจุจ ุถุนู ุงูุฅุดุงุฑุฉ ุงูุทุจูุนู
                message = `๐ก **ุงููููุน ูุดุจูู:** ุชู ุงูุงุนุชูุงุฏ ุนูู ุฅุดุงุฑุงุช ุงูุดุจูุฉ ููุท (${inferredAccuracyText}). ุงููููุน ุงูุฌุบุฑุงูู ูุฏ ูููู ูุฎููุงู ุจุณุจุจ ุถุนู ุงูุฅุดุงุฑุฉ ุฃู ุฅุนุฏุงุฏุงุช ุงูุฌูุงุฒ.`;
                className = 'suspicious';
            }
            
            // ุชุญุฏูุซ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ
            finalResult = { message: message, className: className };
            return { 
                lat, lon, acc, discrepancy, 
                source: source,
                inferred_accuracy: inferredAccuracyText 
            };
        }
        
        // --- ุฏุงูุฉ ุจุฏุก ุงููุญุต ุงูุฑุฆูุณูุฉ ---
        function startScan() {
            document.getElementById('scanButton').disabled = true;
            updateProgress(5, "5% - ุฌุงุฑู ูุญุต ูููุฉ ุงูุฌูุงุฒ...");
            
            const deviceInfo = getDeviceInfo();

            // 1. ุฌูุจ ูููุน IP ุจุงูุชูุงุฒู ูุน ุงููุญุต
            const ipPromise = getIPLocation();

            // 2. ุทูุจ ูููุน ุงููุณุชุดุนุฑุงุช (GPS)
            const gpsPromise = new Promise((resolve, reject) => {
                updateProgress(15, "15% - ูุฑุฌู ุงูููุงููุฉ ุนูู ูุดุงุฑูุฉ ุงููููุน ูู ุงููุงูุฐุฉ ุงูููุจุซูุฉ.");
                navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true, timeout: 7000, maximumAge: 0 });
            });

            // 3. ุฅุฏุงุฑุฉ ุดุฑูุท ุงูุชูุฏู ุงููููู
            const startTime = Date.now();
            const progressInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                let progress = 5 + Math.min(95, Math.floor((elapsed / SCAN_DURATION_MS) * 90));
                
                if (progress > 95) progress = 95; 

                updateProgress(progress);
            }, 50); 

            // 4. ูุนุงูุฌุฉ ุงููุชุงุฆุฌ ุจุนุฏ ุงูุชูุงู ูู ูู IP ู GPS
            Promise.allSettled([ipPromise, gpsPromise])
                .then(results => {
                    clearInterval(progressInterval); 
                    updateProgress(98, "98% - ุฌุงุฑู ุชุฌููุน ูุชุญููู ุงูุจูุงูุงุช...");

                    const ipInfo = results[0].status === 'fulfilled' ? results[0].value : null;
                    const gpsPosition = results[1].status === 'fulfilled' ? results[1].value : null;

                    let gpsInfo = { lat: 0, lon: 0, acc: 999999, discrepancy: 0, source: 'ูุดู ุงููุฑุงุกุฉ', inferred_accuracy: 'ูุดู ุงููุฑุงุกุฉ' };
                    
                    if (gpsPosition) {
                        gpsInfo = analyzeLocation(gpsPosition, ipInfo);
                    } else {
                        // ูุดู ูุฑุงุกุฉ GPS 
                        finalResult = {
                            message: "๐ด ูุดู ุงููุญุต: ุชุนุฐุฑ ูุฑุงุกุฉ ุงููููุน (ุชุฃูุฏ ูู ุงูููุงููุฉ ุนูู ุงูุฅุฐู).",
                            className: 'critical'
                        };
                    }
                    
                    setTimeout(() => {
                        updateProgress(100, "100% - ุงูุชูู ุงููุญุต ุงูุฃููู ุจูุฌุงุญ.");
                        displayFinalResults(finalResult, deviceInfo, ipInfo, gpsInfo);
                    }, 500); 
                });
        }
    </script>
</body>
</html>
